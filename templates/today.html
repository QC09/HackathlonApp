<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans h-screen flex">


    <aside class="bg-white w-64 shadow-md flex flex-col p-6">
        <div class="flex items-center mb-10">
            <div class="bg-blue-600 text-white rounded-xl flex justify-center p-2">
                <i data-lucide="graduation-cap" class="w-8 h-8"></i>
            </div>
            <div class="px-3">
                <h1 class="font-bold text-lg">TaskPlan</h1>
                <p class="text-gray-400 text-sm">Student Planner</p>
            </div>
        </div>

        <nav class="flex flex-col gap-4 mb-10">
            <a href="/today" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100">
                <i data-lucide="house"></i>
                <p>Today</p>
            </a>

            <a href="/plan" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100">
                <i data-lucide="calendar"></i>
                <p>Plan</p>
            </a>

            <a href="/insights" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100">
                <i data-lucide="trending-up"></i>
                <p>Insights</p>
            </a>

            <a href="/profile" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100">
                <i data-lucide="user-round"></i>
                <p>Profile</p>
            </a>
        </nav>

        <button command="show-modal" commandfor="dialog" class="bg-blue-600 text-white rounded-lg py-3 hover:bg-blue-700 transition">
            + Add Task
        </button>
        
        <p class="text-gray-400 text-xs mt-auto">v1.0.0</p>
    </aside>


    <main class="flex-1 p-10 overflow-auto">
        <div class="mb-8">
            <h2 class="text-4xl font-semibold mb-1">Today</h2>
            <p class="text-gray-500">Saturday, January 30, 2026</p>
        </div>

        <div class="grid grid-cols-2 gap-6">

            <!-- Study Strategy -->
            <div class="col-span-2 bg-white rounded-xl shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-xl font-semibold">Study Strategy</h1>
                    <button id="strategyBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                        ✨ Generate Strategy
                    </button>
                </div>
                <div id="strategyResult" class="prose prose-sm text-gray-600 max-w-none">
                    <p class="text-gray-400 text-center py-4">Click "Generate Strategy" to get a personalized study plan based on your current deadlines.</p>
                </div>
            </div>
        

            <!-- Upcoming Deadlines -->
            <div class="col-span-2">
                <div class="flex items-center justify-between mb-3">
                    <h1 class="text-2xl font-medium">Upcoming Deadlines</h1>
                    <a href="/plan" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        Go to Plan
                    </a>
                </div>
                <div class="bg-white rounded-xl shadow p-4 space-y-3">
                    {% if assignments %}
                        {% for assignment in assignments %}
                        <div class="flex justify-between items-center py-2 border-b last:border-b-0">
                            <div>
                                <p class="font-medium">{{ assignment.name }}</p>
                                <p class="text-sm text-gray-400">{{ assignment.duedate if assignment.duedate else "No deadline set" }}</p>
                            </div>
                            <span class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">Effort: {{ assignment.effort }}/10</span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-8 text-gray-400">
                            <i data-lucide="inbox" class="w-10 h-10 mx-auto mb-2"></i>
                            <p>No assignments yet. Go to Plan to add your first assignment.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Task List with Dropdown -->
            {% if assignments %}
            <div class="col-span-2 flex flex-col gap-4">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-medium">Tasks</h1>
                    <select id="assignmentSelect" onchange="onChangeAssignment()" class="border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500">
                        {% for assignment in assignments %}
                        <option value="{{ assignment.id }}">{{ assignment.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                {% for assignment in assignments %}
                <div class="assignment_tasks {% if not loop.first %}hidden{% endif %}" id="{{ assignment.id }}">
                    <div class="bg-white rounded-xl shadow p-4 space-y-3">
                        {% for task in assignment.tasks %}
                        <label class="flex items-start gap-3 cursor-pointer">
                            <input type="checkbox" class="mt-1 w-4 h-4 rounded border-gray-300 text-blue-500 focus:ring-blue-400">
                            <div>
                                <p class="font-medium">{{ task.name }}</p>
                                <p class="text-gray-500 text-sm">{{ task.description }}</p>
                            </div>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

        </div>
    </main>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/lib/marked.min.js"></script>
    <script>
        lucide.createIcons();

        function onChangeAssignment() {
            const selected = document.getElementById("assignmentSelect").value;
            const sections = document.getElementsByClassName("assignment_tasks");
            for (const section of sections) {
                section.classList.toggle("hidden", section.id != selected);
            }
        }

        const strategyBtn = document.getElementById("strategyBtn");
        const strategyResult = document.getElementById("strategyResult");

        strategyBtn.addEventListener("click", async () => {
            strategyBtn.disabled = true;
            strategyBtn.textContent = "Generating...";
            strategyResult.innerHTML = '<p class="text-gray-400 text-center py-4">Analyzing your deadlines...</p>';

            try {
                const response = await fetch("/generate-strategy");
                if (response.ok) {
                    const data = await response.json();
                    strategyResult.innerHTML = marked.parse(data.strategy);
                } else {
                    throw new Error("Failed");
                }
            } catch (error) {
                strategyResult.innerHTML = '<p class="text-red-500 text-center py-4">Error generating strategy. Please try again.</p>';
            } finally {
                strategyBtn.disabled = false;
                strategyBtn.textContent = "✨ Generate Strategy";
            }
        });
    </script>
</body>
</html>
